#!/bin/sh
# postinst script for peerbox
#
# see: dh_installdeb(1)

conf() {
	echo "Configuring .vaultress directory for each user..."
	for _HOME in /home/*?; do
		# Obtain the username
		USER=$( basename ${_HOME} )

		if [ ! -d "$_HOME/.vaultress" ]; then
			echo "Vaultress directory not found for user $USER! Creating one now."
			mkdir $_HOME/.vaultress
		fi

		if [ ! -f $_HOME/.vaultress/vaultress.conf ]; then
			echo "Vaultress configuration file not found for user $USER! Creating one now."
			echo -e "rpcuser=rpcuser\nrpcpassword=$(head /dev/urandom | tr -dc A-Za-z0-9 | head -c10)" > $_HOME/.vaultress/vaultress.conf
		fi
		chown -R $USER: $_HOME/.vaultress
	done
}

set -e

case "$1" in
    configure)
	conf
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
